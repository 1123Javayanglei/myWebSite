console.log=function(){};console.log=function(){};console.log=function(){};console.log=function(){};!function(){"use strict";function e(e){console.log("httpRequest = "+e);var t=document.getElementsByClassName("Alert")[0],o=Math.round((new Date).getTime()/T),s=void 0!==h?Date.parse(h.getAttribute("datetime"))/T:o,i=Date.parse(e.getResponseHeader("Last-Modified"))/T;if(console.log("UPDATED = "+h),console.log("DOMAlert = "+t),a(e,i,A)){console.log("****** NEW ALERT ******");var d=e.responseText;if(console.log("newAlertContent = "+d),c(d)){d=JSON.parse(d),console.log("WE HAVE DATA");var g=d[0];if(console.log("dateOfAlertCached = "+A),console.log("currentAlertTime = "+s),console.log("myAlert.unixDate = "+g.unixDate),A=s,console.log("dateOfAlertCached = "+A),l(g.description,o-g.unixDate)||!1===p)console.log("ALL CLEAR AND EXPIRED"),document.documentElement.classList.remove("is-alert"),r(v);else if(g.unixDate===A)console.log("DO NOTHING"),document.documentElement.classList.remove("is-alert");else{var f=document.documentElement.className.split(" ").indexOf("is-alert");if(console.log("isAlertClass = "+f),-1===f&&p&&!u&&document.documentElement.classList.add("is-alert"),-1!==f&&!p&&u&&document.documentElement.classList.remove("is-alert"),console.log("SHOW ALERT"),console.log("currentAlertTime = "+s),s===Date.parse(g.dcDate))return void console.log("SAME DATETIME STAMP");var E=document.createElement("div"),M="AlertMessage--current",N=document.getElementsByClassName(M)[0],y=void 0!==N;console.log("IS CURRENT ALERT = "+y),console.log("document.getElementsByClassName(currentClass) = "+document.getElementsByClassName(M)),console.log("document.getElementsByClassName(currentClass)[0] = "+document.getElementsByClassName(M)[0]),console.log("currentAlert = "+N),console.log("typeof currentAlert = "+typeof N);var S="";console.log("HTMLTemplate = "+m);var D=void 0===t||L?"banner":"body";if(console.log("COMMENT_MODE = "+u),console.log("TYPE = "+D),u&&(console.log("REPLACE TAGS"),m=m.replace(/(<\/?)(h3|p|a(<)|a( )|a(>))/gi,"$1span$4$5"),m=m.replace(/<img.*?">/gi,""),m=m.replace(/<b.*?<\/b>/gi,""),m=m.replace(/See all updates/gi,"")),console.log("HTMLTemplate = "+m),""!==m){console.log("Get HTML Template"),S=m,console.log("newContent = "+S),console.log("alertHomePage = "+v),console.log("alertArchivePage = "+L),console.log("type = "+D),console.log("commentMode = "+u);var H="-->",w="<!--";for(var O in g)g.hasOwnProperty(O)&&(C=new RegExp("{{"+O+"}}","g"),u&&"dcDate"!==O&&!L&&"body"===D||u&&"dcDate"!==O&&!v&&"banner"===D?(H="-->",w="<!--"):(H="",w=""),S=S.replace(C,w+g[O]+H));C=new RegExp("{{alertPath}}","g"),S=S.replace(C,n()+"/"),S=S.replace(/tempalte/g,""),S=v?S.replace(/<alert-home-remove>[\s\S]*?<\/alert-home-remove>/g,""):S.replace(/<\/?alert-home-remove>/g,""),E.innerHTML=S,console.log("newAlert.innerHTML = "+E);var R=E.getElementsByClassName("AlertMessage__dateline")[0].getAttribute("datetime");console.log("newContent = "+S);var x=document.getElementsByClassName("AlertHeader")[0];if(y&&v)console.log("newAlertDateTime = "+R),-1===N.innerHTML.indexOf(R)&&(N.classList.remove(M),N.parentNode.insertBefore(E,N));else if(!y&&v)console.log("!isCurrentAlert && alertHomePage"),t=document.getElementsByClassName("Alert")[0],console.log("typeof DOMAlert = "+typeof t),console.log("DOMAlert = "+t),void 0!==t&&t.appendChild(E);else if(y)if(console.log("isCurrentAlert"),console.log("newAlertDateTime = "+R),console.log("currentClass = "+M),-1===N.innerHTML.indexOf(R)||-1!==N.innerHTML.indexOf(R)&&!u){console.log("write a new alert"),N.innerHTML=E.getElementsByClassName(M)[0].innerHTML;var P=x.innerHTML;P=P.replace("<!--",""),P=P.replace("-->",""),x.innerHTML=P}else u&&(console.log("don’t write a new alert"),N.innerHTML=S,console.log("alertHeader.innerHTML = "+x.innerHTML),x.innerHTML="<!--"+x.innerHTML+"-->");else{console.log("First alert AND we’re NOT on alert’s home page");var B=document.getElementsByClassName("bodyContainer")[0],b=document.body;if(void 0===B){B=document.createElement("div"),t=document.createElement("div");var q=b.children;for(B.classList.add("bodyContainer"),B.classList.add("alertBodyContainer"),b.appendChild(B),t.classList.add("Alert"),t.classList.add("Alert--banner");q.length>1;)B.appendChild(q[0]),q=b.children;t.innerHTML=E.innerHTML,B=document.getElementsByClassName("bodyContainer")[0],B.parentNode.insertBefore(t,B)}else t=document.getElementsByClassName("Alert")[0],console.log("DOMAlert = "+t),void 0!==t&&(t.innerHTML=E.innerHTML)}}}}else r(v)}else console.log("typeof updated = "+typeof h),console.log("alertsOn = "+p),void 0!==h?l(document.getElementsByClassName("AlertMessage__description")[0],o-s)&&r(v):void 0===h&&!1===p&&r(v)}function t(e){var t="."+e+".",o=window.location.href,n=o.indexOf(t);if(-1===n)n="";else{n=o.substr(n+t.length-1);var l=n.indexOf("/");-1!==l&&(n=n.substring(0,l))}return n}function o(){return n()+"/app"}function n(){var e="vassar.edu";return"//alert.vassar.edu"+t("vassar.edu")}function l(e,t){return void 0!==e&&("object"==typeof e&&(e=e.innerHTML),console.log("el = "+e),console.log("timeSinceLastAlert = "+t),-1!==e.toLowerCase().indexOf("turn off the cap and rss"))&&(console.log("TRUE"),!0)}function a(e,t,o){return console.log("BEGIN IS NEW ALERT"),e.readyState===XMLHttpRequest.DONE&&(console.log("XMLHttpRequest.DONE"),200===e.status&&(console.log("httpRequest.status === 200"),console.log("dateOfAlertCached = "+o),console.log("dateOfAlertCached = "+d(o)),console.log("dateOfAlertFile = "+d(t)),t>o))?(console.log("IS NEW ALERT"),!0):(console.log("IS NOT NEW ALERT"),!1)}function s(e,t){var o=document.getElementsByTagName("link"),n=e+"/alert.",l=n+Math.round((new Date).getTime()/T)+".css",a=!t,s="";console.log("existingCSS = "+o);for(var r=0;r<o.length;r++)console.log("existingCSS[x].href = "+o[r].href),-1!==o[r].href.indexOf(n)&&(s=o[r],console.log("existingAlertCSS.href = "+s.href),a=!1,console.log("injectAlertCSS = false"));if(a){var c=document.createElement("link");c.rel="stylesheet",c.href=l,document.getElementsByTagName("head")[0].appendChild(c)}else t&&(console.log("existingAlertCSS = "+s),""!==s&&(console.log("removeAlertCSS"),console.log("existingAlertCSS.href = "+s.href),s.parentNode.removeChild(s)))}function r(e){var t=document.getElementsByClassName("Alert")[0],o=document.getElementsByClassName("Alert--archive")[0];if(console.log("alertHomePage = "+e),e)void 0!==t&&(console.log(t.innerHTML=""),t.innerHTML="");else{var n=document.getElementsByClassName("bodyContainer")[0];if(void 0!==t&&o!==t&&t.parentNode.removeChild(t),void 0!==n){var l=n.children;if(void 0!==l)for(;l.length>0;)document.body.appendChild(l[0]),l=n.children;n.parentNode.removeChild(n)}!L&&t&&t.classList.add("Alert--banner")}}function c(e){return!!i(e)}function i(e){try{JSON.parse(e)}catch(e){return!1}return!0}function d(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=new Date(e*T),n=o.getFullYear(),l=t[o.getMonth()],a=o.getDate(),s=o.getHours(),r="0"+o.getMinutes(),c="0"+o.getSeconds(),i="pm";return s-12>0?s-=12:i="am",l+"-"+a+"-"+n+" "+s+":"+r.substr(-2)+":"+c.substr(-2)+" "+i}var g=function(e){"interactive"===document.readyState||"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)},m="",u=!1,p=!0,f=o(),E="/json/alert.json",T=1e3,h=document.getElementsByClassName("AlertMessage__dateline")[0],A=void 0!==h?Date.parse(h.getAttribute("datetime"))/T:new Date(0).getTime()/T,C=new RegExp("(http(s)?:"+n()+"(/index.html|/)?)","g"),v=""===window.location.href.replace(C,""),M=new RegExp("(http(s)?:"+n()+"(/archive.html)?)","g"),L=""===window.location.href.replace(M,""),N=function(t){e(t)};console.log("UPDATED 1 = "+h),console.log("dateOfAlertCached = "+A);var y=function(e,t){return new Promise(function(o,n){var l=new XMLHttpRequest;if(!l)return console.log("RETURN FALSE"),!1;console.log("OPEN HTTP REQUEST"),l.open("GET",f+e+"?"+Math.round((new Date).getTime()/T)),l.send(),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&200===l.status&&(s(f,u),t.apply(this,[l]))}})},S=function(){return new Promise(function(e,t){console.log("readAlertTemplate started");var o=new XMLHttpRequest;if(!o)return console.log("RETURN FALSE"),!1;console.log("OPEN HTTP REQUEST"),o.open("GET",f+"/alertTemplate.htm?"+Math.round((new Date).getTime()/T)),o.send(),o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&200===o.status&&(console.log("readAlertTemplate completed"),e({data:o}))}})},D=function(e){return new Promise(function(t,o){console.log("setAlertTemplate started"),m=e.data.responseText,console.log("setAlertTemplate completed"),t({newData:e.data})})},H=function(){return new Promise(function(e,t){console.log("readAlertFile started");var o=E,n=new XMLHttpRequest;if(!n)return console.log("RETURN FALSE"),!1;console.log("OPEN HTTP REQUEST"),n.open("GET",f+o+"?"+Math.round((new Date).getTime()/T)),n.send(),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status&&(console.log("httpRequest = "+n),console.log("readAlertFile completed"),e({data:n}))}})},w=function(e){return new Promise(function(t,o){console.log("getCSS started"),console.log("alertFile.data = "+e.data),console.log("getAlertContent = "+N),s(f,u),console.log("getCSS completed"),t({newdata:e.data})})},O=function(t){return new Promise(function(o,n){console.log("getAlert started"),console.log("alertFile.data.responseText = "+t.data.responseText),e(t.data),console.log("getAlert completed")})},R=function(){return new Promise(function(e,t){console.log("readConfig started"),console.log("alertAppPath = "+f);var o=f;o=o.replace(/\/app/,""),console.log("thePath = "+o);var n=o+"/assets/config.json",l=new XMLHttpRequest;if(console.log("file = "+n),!l)return console.log("RETURN FALSE"),!1;console.log("OPEN HTTP REQUEST"),l.open("GET",n+"?"+Math.round((new Date).getTime()/T)),l.send(),l.onreadystatechange=function(){l.readyState===XMLHttpRequest.DONE&&200===l.status&&(console.log("httpRequest = "+l),console.log("readConfig completed"),e({data:l}))}})},x=function(e){return new Promise(function(t,o){console.log("readConfigContent started"),console.log("configFile.data.responseText = "+e.data.responseText);var n=JSON.parse(e.data.responseText);console.log("configContent.alertCommentMode = "+n.alertCommentMode),u=n.alertCommentMode,console.log("configContent.alertsOn = "+n.alertsOn),p=n.alertsOn,console.log("readConfigContent completed"),t({newdata:e.data})})};g(function(){console.log("DOM READY"),S().then(D).then(R).then(x).then(w).then(H).then(O)}),setInterval(function(){S().then(D).then(R).then(x).then(w).then(H).then(O)},120*T)}();